# NocoBase 外部数据源插件使用手册

## 概述

NocoBase 外部数据源插件是一个专为 NocoBase 平台设计的扩展组件，旨在帮助您连接和管理外部数据库系统，如 MySQL 和 PostgreSQL。通过本插件，您可以直接在 NocoBase 中查询和操作这些外部数据库中的数据，而无需将数据迁移到 NocoBase 的主数据库中。

本插件提供了友好的图形界面，方便您管理数据库连接、浏览表结构以及执行 SQL 查询，适合需要与现有数据系统集成的用户。

## 安装与配置

### 安装前提条件

- 已安装并正常运行的 NocoBase 平台
- 对目标外部数据库的访问权限
- 外部数据库的连接信息（主机地址、端口、用户名、密码等）

### 安装步骤

1. **通过插件管理器安装**
   
   a. 登录 NocoBase 管理界面
   b. 导航到"设置" > "插件管理"
   c. 点击"添加插件"按钮
   d. 输入插件名称：`@nocobase/plugin-external-datasource`
   e. 点击"安装"按钮
   f. 安装完成后，在插件列表中启用该插件

2. **手动安装**

   a. 下载插件包
   b. 解压到 NocoBase 的 plugins 目录
   c. 重启 NocoBase 服务
   d. 在管理界面的插件管理中启用该插件

### 初始配置

安装并启用插件后，将在管理设置中添加一个新的菜单项"外部数据源"。首次使用前不需要额外的配置，您可以直接开始添加外部数据源。

## 基本使用

### 添加外部数据源

1. 在 NocoBase 管理界面，导航到"设置" > "外部数据源"
2. 点击"添加数据源"按钮
3. 填写以下信息：
   - **名称**：为数据源指定一个易于识别的名称
   - **类型**：选择数据库类型（MySQL 或 PostgreSQL）
   - **主机**：数据库服务器地址（如 localhost 或 IP 地址）
   - **端口**：数据库服务端口（MySQL 默认为 3306，PostgreSQL 默认为 5432）
   - **用户名**：具有适当权限的数据库用户
   - **密码**：该用户的密码
   - **数据库**：要连接的数据库名称
   - **启用**：勾选以立即启用此数据源
4. （可选）展开"高级选项"，根据需要配置：
   - 对于 MySQL：字符集和时区
   - 对于 PostgreSQL：架构和 SSL 设置
5. 点击"测试连接"按钮验证连接是否成功
6. 点击"创建"按钮保存数据源配置

### 管理数据源

在数据源列表页面，您可以：

- **查看**所有已配置的数据源及其状态
- **编辑**：修改现有数据源的配置
- **测试连接**：验证数据源连接状态
- **启用/禁用**：通过开关控制数据源是否可用
- **删除**：移除不再需要的数据源
- **访问 SQL 浏览器**：打开数据源的 SQL 查询界面

## SQL 浏览器

SQL 浏览器是本插件的核心功能，用于直接与外部数据库交互。

### 界面布局

SQL 浏览器界面分为以下几个区域：

1. **左侧面板**：显示数据库中的表列表和表结构
2. **查询编辑器**：用于编写 SQL 查询的文本区域
3. **结果区域**：显示查询执行后的结果

### 浏览表结构

1. 在左侧面板中，从下拉列表选择一个表
2. 系统将显示该表的列信息，包括列名和数据类型
3. 点击"查询数据"按钮可快速生成并执行查询该表的 SQL 语句

### 执行 SQL 查询

1. 在查询编辑器中输入您要执行的 SQL 语句
   - 对于 MySQL：`SELECT * FROM 表名 LIMIT 100;`
   - 对于 PostgreSQL：`SELECT * FROM 表名 LIMIT 100;`
2. 点击"执行"按钮运行查询
3. 查询结果将在下方的结果区域以表格形式显示

### 常用操作

1. **查询表数据**：
   ```sql
   SELECT * FROM 表名 LIMIT 100;
   ```

2. **条件查询**：
   ```sql
   SELECT * FROM 表名 WHERE 列名 = '值';
   ```

3. **计数查询**：
   ```sql
   SELECT COUNT(*) FROM 表名;
   ```

4. **分组查询**：
   ```sql
   SELECT 列名, COUNT(*) FROM 表名 GROUP BY 列名;
   ```

> 注意：为保障安全，插件默认不支持执行数据修改操作（INSERT、UPDATE、DELETE）和数据定义语言（CREATE、ALTER、DROP）。如需这些功能，请联系系统管理员修改配置。

## 高级使用

### 使用 SQL 结果作为数据源

通过本插件执行的 SQL 查询结果，可以：

1. **导出**：将查询结果导出为 CSV 文件
2. **复制**：将结果复制到剪贴板，以便在其他应用中使用

### 链接到工作流

在未来版本中，本插件将支持与 NocoBase 工作流集成，使您能够：

1. 在工作流中执行预定义的 SQL 查询
2. 将 SQL 查询结果用作工作流的输入
3. 基于工作流触发 SQL 查询

## 安全与性能考虑

### 安全最佳实践

1. **使用只读账户**：为插件配置只读数据库用户，避免意外的数据修改
2. **限制数据库用户权限**：仅授予必要的数据库权限
3. **启用 SSL 连接**：在生产环境中使用 SSL 加密数据传输
4. **定期更改密码**：定期更新存储在插件中的数据库密码

### 性能优化

1. **限制查询结果**：在查询中使用 LIMIT 子句限制返回的数据量
2. **优化查询语句**：编写高效的 SQL 查询，避免全表扫描
3. **索引使用**：确保查询使用了适当的索引
4. **连接池管理**：插件内部使用连接池管理数据库连接，减少连接开销

## 常见问题与解决方案

### 无法连接到数据库

1. **检查网络连接**：确保 NocoBase 服务器能够访问外部数据库服务器
2. **验证凭据**：确认用户名和密码正确
3. **检查防火墙设置**：确保数据库端口已在防火墙中开放
4. **检查数据库服务状态**：确认外部数据库服务正在运行

### 查询执行失败

1. **SQL 语法错误**：检查 SQL 语句的语法
2. **权限不足**：确认数据库用户具有执行该查询的权限
3. **数据库限制**：检查数据库是否有查询超时或资源限制设置

### 性能问题

1. **查询过于复杂**：简化查询或分解为多个小查询
2. **数据量过大**：添加适当的筛选条件限制结果集大小
3. **缺少索引**：在频繁查询的列上创建适当的索引

## 插件限制

1. 目前仅支持 MySQL 和 PostgreSQL 数据库
2. 不支持自动同步外部数据库结构到 NocoBase 集合
3. 某些复杂的数据库功能可能不被支持

## 未来计划

1. 支持更多数据库类型（SQL Server, Oracle, MongoDB 等）
2. 实现数据结构映射，支持将外部表映射为 NocoBase 集合
3. 支持存储过程和函数的执行
4. 提供查询历史记录和收藏功能
5. 支持查询结果可视化

## 技术支持与反馈

如果您在使用过程中遇到问题，或有功能改进建议，请通过以下渠道联系我们：

1. GitHub 仓库 Issue
2. NocoBase 社区论坛
3. 官方支持邮箱

---

感谢您使用 NocoBase 外部数据源插件！ 