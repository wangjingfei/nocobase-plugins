# 外部数据源插件使用说明

## 概述

`@toga/plugin-external-datasource` 插件为 NocoBase 提供了连接和管理外部数据源的功能。您可以通过这个插件连接到外部的 MySQL、PostgreSQL 数据库和 REST API 数据源。

## 功能特性

- **多种数据源类型支持**：
  - MySQL 外部数据库
  - PostgreSQL 外部数据库  
  - REST API 数据源

- **完整的管理界面**：
  - 现代化的用户界面设计
  - 下拉菜单式的"添加数据源"按钮
  - 数据源列表展示
  - 编辑、删除、同步操作

- **数据同步功能**：
  - 支持手动触发数据同步
  - 同步状态跟踪
  - 最后同步时间记录

## 如何访问插件

插件已被注册到 NocoBase 的设置页面中，您可以通过以下方式访问：

### 方式一：通过设置页面
1. 登录 NocoBase 后台管理界面
2. 点击右上角的用户头像或设置图标
3. 选择 **"设置"** 菜单
4. 在左侧菜单中找到 **"外部数据源"** 选项
5. 点击进入外部数据源管理页面

### 方式二：直接通过URL访问
访问地址：`http://your-domain/admin/settings/external-datasource`

## 使用步骤

### 1. 添加数据源

在外部数据源管理页面：

1. 点击右上角的 **"添加数据源"** 下拉按钮
2. 从下拉菜单中选择要添加的数据源类型：
   - **MySQL 外部数据库**
   - **PostgreSQL 外部数据库** 
   - **REST API 数据源**

### 2. 配置数据源

#### MySQL 数据库配置
- **数据源名称**：为数据源指定一个唯一的名称
- **主机地址**：MySQL 服务器地址
- **端口**：通常为 3306
- **数据库名**：要连接的数据库名称
- **用户名和密码**：数据库认证信息

#### PostgreSQL 数据库配置
- **数据源名称**：为数据源指定一个唯一的名称
- **主机地址**：PostgreSQL 服务器地址
- **端口**：通常为 5432
- **数据库名**：要连接的数据库名称
- **用户名和密码**：数据库认证信息
- **模式名**：默认为 "public"

#### REST API 数据源配置
- **数据源名称**：为数据源指定一个唯一的名称
- **API 基础地址**：REST API 的基础 URL
- **认证类型**：选择合适的认证方式
  - 无认证
  - 基础认证（用户名/密码）
  - API Key
  - Bearer Token
- **自定义请求头**：可添加额外的 HTTP 头部

### 3. 测试连接

配置完成后，点击 **"测试连接"** 按钮验证配置是否正确。

### 4. 保存配置

测试成功后，点击 **"保存"** 按钮保存数据源配置。

### 5. 管理数据源

在数据源列表中，您可以进行以下操作：

- **编辑**：修改数据源配置
- **同步**：手动触发数据同步
- **删除**：删除不再需要的数据源

## 界面特性

### 现代化设计
- 采用了类似 NocoBase 官方数据源管理器的界面设计
- 清晰的页面标题和描述
- 美观的数据源类型图标和标签

### 下拉菜单
- **"添加数据源"** 按钮采用下拉菜单设计
- 每个数据源类型都有对应的图标和说明
- 操作简单直观

### 数据表格
- 显示数据源名称、类型、状态和最后同步时间
- 支持分页、快速跳转等功能
- 空状态提示引导用户操作

## API 接口

插件提供了以下 API 接口：

- `GET /api/externalDataSources` - 获取所有外部数据源
- `POST /api/externalDataSources` - 创建新的数据源
- `PUT /api/externalDataSources/:id` - 更新数据源配置
- `DELETE /api/externalDataSources/:id` - 删除数据源
- `POST /api/syncTasks/:id:run` - 运行同步任务

## 故障排除

### 找不到插件菜单
1. 确认插件已在插件管理中成功启用
2. 检查用户是否有访问插件的权限
3. 尝试刷新页面或重新登录

### 连接测试失败
1. **网络问题**：确保 NocoBase 服务器可以访问目标数据库/API
2. **认证错误**：检查用户名、密码或 API 密钥是否正确
3. **端口问题**：确认目标服务的端口是否正确
4. **防火墙**：检查是否有防火墙阻止连接

### 数据同步失败
1. 检查数据源连接是否正常
2. 确认同步任务配置是否正确
3. 查看系统日志获取详细错误信息

## 注意事项

1. **安全性**：连接信息会被加密存储，但仍建议使用专门的数据库用户账号
2. **性能**：大量数据同步可能影响系统性能，建议在低峰期进行
3. **权限**：确保数据库用户有足够的权限访问所需的表和数据
4. **备份**：在进行重要操作前，建议备份相关数据

## 技术支持

如遇到问题，请：

1. 检查 NocoBase 系统日志
2. 确认数据库连接配置
3. 提供详细的错误信息以便排查 